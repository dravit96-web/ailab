import os
import httpx
from langchain_openai import ChatOpenAI, OpenAIEmbeddings
from langchain.chains import LLMChain
from langchain.prompts import PromptTemplate

def main():
    # Load API key from environment variable for security
    api_key = os.getenv("GENAI_API_KEY")
    if not api_key:
        raise ValueError("API key not found. Set GENAI_API_KEY in your environment.")

    # Use context manager for httpx client
    with httpx.Client() as client:
        llm = ChatOpenAI(
            base_url="https://genailab.tcs.in",
            model="azure_ai/genailab-maas-DeepSeek-V3-0324",
            api_key=api_key,
            http_client=client
        )

        prompt = PromptTemplate(
            input_variables=["question"],
            template="""You are a Linux technical assistant with expertise in system administration 
            and troubleshooting. Provide detailed and accurate answers to the following questions. 
            If it pertains to any other topic, strictly respond with "I can only answer Linux related questions."
            question: {question}"""
        )

        chain = LLMChain(llm=llm, prompt=prompt)

        print("CHAT BOT ready. Type 'exit' to quit.")

        while True:
            question = input("Enter your question: ")
            if question.lower() == 'exit':
                print("Goodbye!")
                break
            try:
                response = chain.run(question=question)
                print(response)
            except Exception as e:
                print(f"Error: {e}")

if __name__ == "__main__":
    main()
